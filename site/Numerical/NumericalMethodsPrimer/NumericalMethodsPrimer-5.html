<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Louis Moresi">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>NumericalMethodsPrimer 5 - Underworld - A Geodynamics Modelling Code</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "NumericalMethodsPrimer 5";
    var mkdocs_page_input_path = "Numerical/NumericalMethodsPrimer/NumericalMethodsPrimer-5.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="icon icon-home"> Underworld - A Geodynamics Modelling Code</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Underworld</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../index.html">Introduction</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../StartHere.md">Getting Started</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Numerical Modelling Primer</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Introduction</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Geodynamics</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Geodynamics/Introduction.html">Introduction</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../Geodynamics/Mathematics.md">Mathematical Background</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Underworld - A Geodynamics Modelling Code</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
    
      
    
    <li>NumericalMethodsPrimer 5</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>\[
\require{color}
\newcommand{\dGamma}{\mathbf{d}\boldsymbol{\Gamma}}
\newcommand{\erfc}{\mbox{\rm erfc}}
\newcommand{\curly}{\sf }
\newcommand{\Red}[1]{\textcolor[rgb]{0.7,0.0,0.0}{#1}}
\newcommand{\Green}[1]{\textcolor[rgb]{0.0,0.7,0.0}{ #1}}
\newcommand{\Blue}[1]{\textcolor[rgb]{0.0,0.0,0.7}{ #1}}
\newcommand{\Emerald}[1]{\textcolor[rgb]{0.0,0.7,0.3}{ #1}}
\newcommand{\curly}
\]</p>
<h3 id="weak-forms-of-some-useful-equations">Weak Forms of Some Useful Equations</h3>
<p>As we discovered earlier, the Galerkin form of weighted residual approximate method can be made equivalent to a full variational problem if integration by parts is employed in the correct manner. This then allows the development of fully automatic variational methods for arbitrary strong forms of the governing equations. From here on we follow the notation of Hughes (The Finite Element Method) which is reasonably clear.</p>
<h4 id="1d-heat-conduction">1D Heat Conduction</h4>
<p>The differential or strong form of the equation we have encountered a number of times is
\begin{equation}
    \begin{split}
        \frac{d^2 u}{d x^2} - {\curly f} &amp;= 0 \;\;\; \text{on} \;\;\; \Omega \
        u(1) &amp; = {\curly g} \
        -\frac{d u}{d x} (0) &amp;= {\curly h}
    \end{split}
\nonumber
\end{equation}</p>
<p>where the boundary conditions are supplied at either end of a domain of unit length.</p>
<p>To find the weak form of the equation we need to have a set of functions <span><span class="MathJax_Preview">\curly S</span><script type="math/tex">\curly S</script></span> to use for the trial functions which satisfy the boundary condition <span><span class="MathJax_Preview">\curly g</span><script type="math/tex">\curly g</script></span> on <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> at <span><span class="MathJax_Preview">x=1</span><script type="math/tex">x=1</script></span>. We also need a set of weighting functions which are zero at <span><span class="MathJax_Preview">x=1</span><script type="math/tex">x=1</script></span> which we call <span><span class="MathJax_Preview">\curly V</span><script type="math/tex">\curly V</script></span>. The weighting functions play the role of the variations.</p>
<p>The statement of the weak form of the problem (as distinct from its solution which will wait till later) is then to find <span><span class="MathJax_Preview">u \in {\curly S}</span><script type="math/tex">u \in {\curly S}</script></span> such that for all <span><span class="MathJax_Preview">w \in {\curly V}</span><script type="math/tex">w \in {\curly V}</script></span></p>
<div>
<div class="MathJax_Preview">\begin{equation}
    {\int_0^1 \frac{d w }{d x} \frac{d u}{d x} dx - \int_0^1 w f dx + w(0) h = 0}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    {\int_0^1 \frac{d w }{d x} \frac{d u}{d x} dx - \int_0^1 w f dx + w(0) h = 0}
\nonumber
\end{equation}</script>
</div>
<p>This looks a lot like the variational solutions we found before. How do we get to it ?
The procedure is relatively general (except that in higher dimensions it becomes more
time consuming). First assume we have found the solution to the strong form, <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span>. This must
satisfy
\begin{equation}
    0 = \int_0^1 w( \frac{d^2 u}{d x^2} - {\curly f} )dx
\nonumber
\end{equation}</p>
<p>by the definition of the problem, as long as <span><span class="MathJax_Preview">w</span><script type="math/tex">w</script></span> is well behaved, which
is ensured by a sensible choice of weighting functions. This starts to look
a lot like the Galerkin approach although we are not yet seeking an approximate
solution. Now integrate by parts to give</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    0 = \int_0^1 \frac{d w }{d x} \frac{d u}{d x} dx - \int_0^1 w f dx - \left[ w \frac{d u}{d x} \right] _ 0^1
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    0 = \int_0^1 \frac{d w }{d x} \frac{d u}{d x} dx - \int_0^1 w f dx - \left[ w \frac{d u}{d x} \right] _ 0^1
\nonumber
\end{equation}</script>
</div>
<p>the boundary conditions on <span><span class="MathJax_Preview">du / dx</span><script type="math/tex">du / dx</script></span> are substituted to give the weak form as above.
We write the equation in terms of the symmetric operators:
\begin{equation}
    \begin{split}
    a(w,u) &amp; \equiv     \int_0^1 \frac{d w }{d x} \frac{d u}{d x} dx \
    (w,{\curly f})  &amp; \equiv  \int_0^1 w f dx
    \end{split}
\nonumber
\end{equation}</p>
<p>to obtain an abstract form which can be used for all the finite element
formulations we derive here</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    a(w,u) = (w,{\curly f})  + w(0){\curly h}
    \label{eq:FEabst}
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    a(w,u) = (w,{\curly f})  + w(0){\curly h}
    \label{eq:FEabst}
\end{equation}</script>
</div>
<p>Note, that the partial differentiation step produces a symmetric operator from the
non symmetric initial form. This approach also works in 2D as follows.  </p>
<h4 id="2d-heat-conduction">2D Heat Conduction</h4>
<p>Define a heat flux (vector), <span><span class="MathJax_Preview">\mathbf{q}</span><script type="math/tex">\mathbf{q}</script></span> related to temperature, <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> as    follows</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    q_i = -K_{ij} \frac{\partial u}{\partial x_j}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    q_i = -K_{ij} \frac{\partial u}{\partial x_j}
\nonumber
\end{equation}</script>
</div>
<p>where <span><span class="MathJax_Preview">\mathbf{K}</span><script type="math/tex">\mathbf{K}</script></span> is the symmetric conductivity tensor. (This is the generalized version of Fourier's law). A volumetric heating rate of <span><span class="MathJax_Preview">\curly f</span><script type="math/tex">\curly f</script></span> gives the following strong form</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \begin{split}
        \nabla q - {\curly f} &amp;= 0  \;\;\; \text{on} \;\;\; \Omega \\
        u &amp; = {\curly g} \;\;\; \text{on} \;\;\;  \Gamma_{\curly g} \\
        -q_i n_i &amp;= {\curly h} \;\;\; \text{on} \;\;\; \Gamma_{\curly h}
    \end{split}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \begin{split}
        \nabla q - {\curly f} &= 0  \;\;\; \text{on} \;\;\; \Omega \\
        u & = {\curly g} \;\;\; \text{on} \;\;\;  \Gamma_{\curly g} \\
        -q_i n_i &= {\curly h} \;\;\; \text{on} \;\;\; \Gamma_{\curly h}
    \end{split}
\nonumber
\end{equation}</script>
</div>
<p>where <span><span class="MathJax_Preview">\Gamma_ {\curly g}</span><script type="math/tex">\Gamma_ {\curly g}</script></span> and <span><span class="MathJax_Preview">\Gamma_{\curly h}</span><script type="math/tex">\Gamma_{\curly h}</script></span> are the regions of the boundary with fixed temperatures and fixed fluxes respectively, <span><span class="MathJax_Preview">\mathbf{n}</span><script type="math/tex">\mathbf{n}</script></span> is the unit normal over <span><span class="MathJax_Preview">\Gamma_{\curly h}</span><script type="math/tex">\Gamma_{\curly h}</script></span>.</p>
<p>The corresponding weak form (found in the usual way) is</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    -\int_\Omega  \frac{\partial w}{\partial x_j} q_i d\Omega = \int_\Omega w {\curly f} d\Omega + \int_{\Gamma_{\curly h}} w{\curly h} d\Gamma
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    -\int_\Omega  \frac{\partial w}{\partial x_j} q_i d\Omega = \int_\Omega w {\curly f} d\Omega + \int_{\Gamma_{\curly h}} w{\curly h} d\Gamma
\nonumber
\end{equation}</script>
</div>
<p>The symmetry of the operator is not obvious here until we substitute the constitutive law to obtain</p>
<p>\begin{equation}
    \int_\Omega  \frac{\partial w}{\partial x_j} q_i d\Omega =
     \int_\Omega  \frac{\partial w}{\partial x_j} K_{ij} \frac{\partial u}{\partial x_j} d\Omega =
     \int_\Omega  (\nabla w)^T \mathbf{K} (\nabla u) d\Omega
\nonumber
\end{equation}</p>
<h4 id="2d3d-fluid-flow">2D/3D Fluid Flow</h4>
<p>Now we finally come around to the problem we really need to solve. The strong form of the Stokes' flow problem is identical to that of linear elasticity (which is what all the finite element textbooks deal with). The general constitutive law is</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \sigma_{ij} = c_{ijkl} \epsilon_{kl}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \sigma_{ij} = c_{ijkl} \epsilon_{kl}
\nonumber
\end{equation}</script>
</div>
<p>which reduces to <span><span class="MathJax_Preview">\sigma_{ij} = \eta \epsilon_{ij}</span><script type="math/tex">\sigma_{ij} = \eta \epsilon_{ij}</script></span> for homogeneous fluid.
<span><span class="MathJax_Preview">\epsilon_{ij}</span><script type="math/tex">\epsilon_{ij}</script></span> is defined by</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \epsilon_{ij} = \frac{\partial u_i}{\partial x_j} +  \frac{\partial u_j}{\partial x_i}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \epsilon_{ij} = \frac{\partial u_i}{\partial x_j} +  \frac{\partial u_j}{\partial x_i}
\nonumber
\end{equation}</script>
</div>
<p>where <span><span class="MathJax_Preview">\mathbf{u}</span><script type="math/tex">\mathbf{u}</script></span> now represents the fluid velocity.</p>
<p>The strong form of the equation is <!-- 3 equations --></p>
<div>
<div class="MathJax_Preview">\begin{equation}
        \frac{\partial \sigma _ {ij}}{\partial x _ j} + {\curly f} _ i = 0  \;\;\; \text{on} \;\;\;  \Omega \\
\nonumber
\end{equation}
\begin{equation}
        u _ i = {\curly g} _ i \;\;\; \text{on} \;\;\;  \Gamma_{ {\curly g} _ i} \\
\nonumber
\end{equation}
\begin{equation}
        \sigma _ {ij} n _ i = {\curly h} _ i \;\;\; \text{on} \;\;\; \Gamma_{ {\curly h} _ i}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
        \frac{\partial \sigma _ {ij}}{\partial x _ j} + {\curly f} _ i = 0  \;\;\; \text{on} \;\;\;  \Omega \\
\nonumber
\end{equation}
\begin{equation}
        u _ i = {\curly g} _ i \;\;\; \text{on} \;\;\;  \Gamma_{ {\curly g} _ i} \\
\nonumber
\end{equation}
\begin{equation}
        \sigma _ {ij} n _ i = {\curly h} _ i \;\;\; \text{on} \;\;\; \Gamma_{ {\curly h} _ i}
\nonumber
\end{equation}</script>
</div>
<p>with a corresponding weak form
\begin{equation}
    \int_\Omega \left(  \frac{\partial w _ i}{\partial x _ j} +  \frac{\partial w _ j}{\partial x _ i}  \right)
    \sigma _ {ij} d \Omega =
        \int _ \Omega w _ i {\curly f} _ i d\Omega +
        \sum _ {d=1} ^ {n _ {\rm dim}} \left[ \int _ {\Gamma _ { {\curly h} _ i}} w _ i h _ i d\Gamma \right]
        \nonumber
\end{equation}</p>
<p>Which is symmetric in the trial functions and the unknown velocities since
\begin{equation}
    \int_\Omega \left(  \frac{\partial w_i}{\partial x_j} +  \frac{\partial w_j}{\partial x_i}  \right) \sigma_{ij} d \Omega =
    \int_\Omega \left(  \frac{\partial w_i}{\partial x_j} +  \frac{\partial w_j}{\partial x_i}  \right) c_{ijkl}
        \left(  \frac{\partial u_i}{\partial x_j} +  \frac{\partial u_j}{\partial x_i} \right) d \Omega
\nonumber
\end{equation}</p>
<h3 id="galerkin-approximate-weak-form">Galerkin Approximate Weak Form</h3>
<p>We have one last task before we can develop a real numerical method. How do we get away from the highly abstract notion of trial functions, weighting functions, and weak forms to produce a compact system of equations which can be written out in a nice tidy matrix form. The answer lies in the Galerkin approximate solution method. Let us go back to the 1D problem for a moment. We have to express our solution in terms of a sum over basis functions as before</p>
<div>
<div class="MathJax_Preview">\begin{equation}
        w^h = \sum_{A=1}^{n} c_A  N_A
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
        w^h = \sum_{A=1}^{n} c_A  N_A
\nonumber
\end{equation}</script>
</div>
<p>where the <span><span class="MathJax_Preview">h</span><script type="math/tex">h</script></span> superscript indicates that we have moved from an infinite choice of functions to a finite one based on the discrete functions <span><span class="MathJax_Preview">N_A</span><script type="math/tex">N_A</script></span> which we will define in a minute, although for now we need to ensure that they are zero where the boundary conditions apply in the same way as <span><span class="MathJax_Preview">\curly V</span><script type="math/tex">\curly V</script></span>. We define a corresponding expansion for <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span></p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \begin{split}
        u^h &amp;= \sum_{A=1}^{n} d_A  N_A + {\curly g}N_{n+1} \\
        {\curly g}^h &amp;= {\curly g} N_{n+1}
    \end{split}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \begin{split}
        u^h &= \sum_{A=1}^{n} d_A  N_A + {\curly g}N_{n+1} \\
        {\curly g}^h &= {\curly g} N_{n+1}
    \end{split}
\nonumber
\end{equation}</script>
</div>
<p>which includes an extra basis function to allow the boundary condition (<span><span class="MathJax_Preview">u(1)={\curly g}</span><script type="math/tex">u(1)={\curly g}</script></span>) to be satisfied.</p>
<p>Substituting into (\ref{eq:FEabst}) gives</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    a\left( \sum_{A=1}^n c_A N_A , \sum_{B=1}^n d_B N_B \right) =
    \left( \sum_{A=1}^n c_A N_A , {\curly f} \right) + \left[ \sum_{A=1}^n c_A N_A(0) \right] {\curly h}
    -a\left( \sum_{A=1}^n c_A N_A , {\curly g} N_{n+1} \right)
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    a\left( \sum_{A=1}^n c_A N_A , \sum_{B=1}^n d_B N_B \right) =
    \left( \sum_{A=1}^n c_A N_A , {\curly f} \right) + \left[ \sum_{A=1}^n c_A N_A(0) \right] {\curly h}
    -a\left( \sum_{A=1}^n c_A N_A , {\curly g} N_{n+1} \right)
\nonumber
\end{equation}</script>
</div>
<p>Our operators are symmetric and wholly linear, so the order of summation and application
of the operator can be interchanged freely to give:</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    0 =     \sum_{A=1}^n c_A G_A
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    0 =     \sum_{A=1}^n c_A G_A
\nonumber
\end{equation}</script>
</div>
<p>where</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    G_A = \sum_{B=1}^n a(N_A,N_B)d_B - (N_A,{\curly f}) - N_A(0){\curly h} + a(N_A,A_{n+1}){\curly g}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    G_A = \sum_{B=1}^n a(N_A,N_B)d_B - (N_A,{\curly f}) - N_A(0){\curly h} + a(N_A,A_{n+1}){\curly g}
\nonumber
\end{equation}</script>
</div>
<p>As we have done many times before, we appeal to the argument that the particular choice of variation must be totally arbitrary: this equation must hold no matter what <span><span class="MathJax_Preview">w^h \in {\curly S}^h</span><script type="math/tex">w^h \in {\curly S}^h</script></span> we choose, and hence no matter what the combination of <span><span class="MathJax_Preview">c_A</span><script type="math/tex">c_A</script></span> may be. This then means that <span><span class="MathJax_Preview">G_A</span><script type="math/tex">G_A</script></span> must be identically zero independent of <span><span class="MathJax_Preview">c_A</span><script type="math/tex">c_A</script></span>, i.e.</p>
<div>
<div class="MathJax_Preview">\begin{equation}
     \sum_{B=1}^n a(N_A,N_B)d_B =  (N_A,{\curly f} )
     - N_A(0){\curly h} +
      a(N_A,A_{n+1}) {\curly g}
     \label{eq:gal2}
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
     \sum_{B=1}^n a(N_A,N_B)d_B =  (N_A,{\curly f} )
     - N_A(0){\curly h} +
      a(N_A,A_{n+1}) {\curly g}
     \label{eq:gal2}
\end{equation}</script>
</div>
<p>As in the standard variational method, we have eliminated all references to the actual variation and left unknowns which only related to the physical variables (i.e. the coefficients of the expansion for <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span>).</p>
<p>If we simply write
\begin{equation}
    \begin{split}
        K_{AB} &amp;= a(N_A,N_B)\
        F_A &amp;= (N_A,{\curly f}) + N_A(0)h - a(N_A,N_n+1){\curly g}
    \end{split}
    \label{eq:FEstdform}
\end{equation}</p>
<p>then we have a matrix formulation immediately since (\ref{eq:gal2}) now becomes</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \sum_{B=1}^n  K_{AB} d_B = F_A  \;\;\;\;\;\; A=1,2,3,\ldots
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \sum_{B=1}^n  K_{AB} d_B = F_A  \;\;\;\;\;\; A=1,2,3,\ldots
\nonumber
\end{equation}</script>
</div>
<p>or</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \mathbf{K d} = \mathbf{F}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \mathbf{K d} = \mathbf{F}
\nonumber
\end{equation}</script>
</div>
<p>The matrix <span><span class="MathJax_Preview">\mathbf{K}</span><script type="math/tex">\mathbf{K}</script></span> is known as the stiffness matrix - the association with the matrix of stiffnesses from our discrete set of springs being obvious.</p>
<h3 id="generalization">Generalization</h3>
<p>The same argument can be applied to higher dimensions, and to problems with different constitutive laws, and vector unknowns, however, the identification of the components of the stiffness matrix with the operator <span><span class="MathJax_Preview">a(\cdot,\cdot)</span><script type="math/tex">a(\cdot,\cdot)</script></span> acting on every possible combination of the Galerkin basis functions still holds. When the unknowns are vectors, the basis functions are used in each respective direction which complicates the notation even more than before. Essentially, though it means that the entries to <span><span class="MathJax_Preview">\mathbf{K}</span><script type="math/tex">\mathbf{K}</script></span> from each <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span> and <span><span class="MathJax_Preview">B</span><script type="math/tex">B</script></span> are actually matrices which are <span><span class="MathJax_Preview">n_{\rm dim} \times n_{\rm dim}</span><script type="math/tex">n_{\rm dim} \times n_{\rm dim}</script></span>.</p>
<p>For example, in the constant viscosity Stokes' flow problem, we now have</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \left. K _ {AB}\right| _ {ij}  =    \int _ \Omega
                    \left(  \frac{\partial N _ A}{\partial x _ j} +  \frac{\partial N _ A}{\partial x _ i}  \right) \eta
                    \left(  \frac{\partial N _ B}{\partial x _ j} +  \frac{\partial N _ B}{\partial x _ i} \right) d \Omega
        \label{eq:festokes}         
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \left. K _ {AB}\right| _ {ij}  =    \int _ \Omega
                    \left(  \frac{\partial N _ A}{\partial x _ j} +  \frac{\partial N _ A}{\partial x _ i}  \right) \eta
                    \left(  \frac{\partial N _ B}{\partial x _ j} +  \frac{\partial N _ B}{\partial x _ i} \right) d \Omega
        \label{eq:festokes}         
\end{equation}</script>
</div>
<h3 id="discretization-shape-functions">Discretization &amp; Shape Functions</h3>
<p>Although we have now nominally made our problem finite by expressing everything in terms of Galerkin basis functions, we have yet to decide what those functions ought to be. Whatever our choice, it should make the problem easy to compute numerically.  </p>
<hr />
<p><img alt="" src="../Diagrams/domain1.png" />{. width="75%" id="domain-decomp"}</p>
<p><em>Splitting an arbitrary domain into patches is trivial in an integral formulation. Additionally, the irregular shape of the individual subdomains is easy to handle with standard changes of variables (Jacobians)</em></p>
<hr />
<p>The choice of basis functions is very broad but we narrow it down by tying it very closely to the way we choose to split up the domain of our problem. With an integral method, the domain decomposition is simple since</p>
<div>
<div class="MathJax_Preview">\begin{equation}
     \int_\Omega d\Omega = \int_{\Omega_1} d {\Omega_1} +
            \int_{\Omega_2} d {\Omega_2} + \int_{\Omega_3} d {\Omega_3} + \ldots
            \label{eq:decomp}
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
     \int_\Omega d\Omega = \int_{\Omega_1} d {\Omega_1} +
            \int_{\Omega_2} d {\Omega_2} + \int_{\Omega_3} d {\Omega_3} + \ldots
            \label{eq:decomp}
\end{equation}</script>
</div>
<p>which means that the decomposition <a href="#domain-decomp">shown above</a> is as accurate as the representation of the boundary allows.  </p>
<p>The functions which interpolate the node points at the corners of  subdomains are a suitable set for use as an approximate basis as we require for the Galerkin formulation. This is easy to see if we consider a one dimensional problem.</p>
<hr />
<p><img alt="" src="../Diagrams/linedisc.png" />{. width="75%" id="discretisation-1d"}</p>
<p><em>Representing a piecewise linear function as a sum of pointy functions localized at the nodes</em></p>
<hr />
<p>In the one dimensional case, the choice of subdomains is limited to breaking up the line into a number of segments, though not necessarily of equal length. If the approximation to the continuum field, <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> is made by linear interpolation to give <span><span class="MathJax_Preview">u^h</span><script type="math/tex">u^h</script></span>, then <span><span class="MathJax_Preview">u^h</span><script type="math/tex">u^h</script></span> can also be expressed as a sum on the <a href="#discretisation-1d">local triangular functions <span><span class="MathJax_Preview">N_A</span><script type="math/tex">N_A</script></span></a></p>
<div>
<div class="MathJax_Preview">\begin{equation}
        u^h = \sum_{A} u(x_A) N_A(x)
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
        u^h = \sum_{A} u(x_A) N_A(x)
\nonumber
\end{equation}</script>
</div>
<p>This is an exact representation of the interpolation provided the <span><span class="MathJax_Preview">N_A</span><script type="math/tex">N_A</script></span> takes the value one at node <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span> and zero at all other nodes, and varies in a linear manner in between.</p>
<p>Note that the functions all take the same form apart from scaling. Also, because the basis functions are localized around a node and its neighbours, the direct interaction between a node and its immediate neighbours is non-zero but the interaction with more distant nodes is zero. This makes the stiffness matrix banded --- more importantly it is sparse and therefore the potentially enormous number of interactions (the square of the number of unknowns) is contained. This procedure can be extended to higher dimensions and to higher order interpolations as shown in <a href="#shape-functions">the Figure below</a></p>
<h4 id="naming-of-things-and-what-they-look-like">Naming of Things and What They Look Like</h4>
<p>The interpolation functions are known as shape functions. The subdomains are known as elements. The elements correspond to the individual springs of our discrete example. The shape functions are pure interpolation functions of the required order within the element and can be differentiated the appropriate number of times. This means that the order of interpolation must match the order of derivatives in the FE operator. Crossing the element boundaries, the shape functions have discontinuous derivatives (as do the piecewise interpolations). Continuous derivative functions are possible (e.g. splines) but add significant complexity. Shape functions in 2D and 3D can be formed from the product of 1D shape functions in each direction.</p>
<hr />
<p><img alt="" src="../Diagrams/shapefn.png" />{. width="75%" id="shape-functions"}</p>
<p><em>Extension of simple shape function concept (a) to higher order functions and  (b) to higher dimensions</em></p>
<hr />
<h4 id="element-matrices">Element Matrices</h4>
<p>The <a href="#domain-decomp">domain decomposition illustrated above</a> produces a minature version of the matrix problem on the individual elements themselves.</p>
<div>
<div class="MathJax_Preview">\begin{equation}
            {k^e}_{ij} {d^e}_j = {f^e}_i
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
            {k^e}_{ij} {d^e}_j = {f^e}_i
\nonumber
\end{equation}</script>
</div>
<p>The interpretation of the local problem is similar to that of the individual springs in the discrete example we derived earlier. By assembling the individual under-constrained element problems into the full problem we obtain a soluble system with the correct number of boundary conditions etc. The local equilibrium problem is identical with that of the global problem. That is, we use the same variational form and the same operators to build the local matrices. In general, finite element methods are designed around the local element frame of reference and large problems assembled from smaller ones. The book-keeping involved is to track which degrees of freedom in the local problem are associated with which others in the global problem. Clearly the interaction coefficient between one degree of freedom and another is derived from the local equilibrium relationships of a number of elements because the shape function for a given nodal point is spread across a number of elements.</p>
<h3 id="numerical-integration">Numerical Integration</h3>
<p>The real power of finite elements comes from its ability to handle remarkably distorted geometries with ease. (Obviously this only applies in two or more dimensions). This is possible because simple mappings can be derived to convert a distorted element into a regular one (square, cubic, regular-tetrahedral). This takes the form of a change of variables which can be done {\em fully automatically} if we make minor restrictions on the choice of distortions we allow the elements to have. This restriction takes the form of ensuring that the mappings which transform the element shape can be described by the shape functions of the element. This means that only linear mappings can be applied to linear elements. If we wish to map a curved boundary exactly, then elements which have the appropriate order shape functions have to be used even if they are not needed for the representation of the differential operator. (e.g. quadratic elements for a circular boundary). This concept produces "isoparametric" elements.</p>
<p>The mapping shown in <a href="domain-decomp">the domain decomposition figure</a> is achieved by a change of variables</p>
<div>
<div class="MathJax_Preview">\begin{equation}
     \int  \int_{\Omega^e} \phi dx dy = \int  \int_{\rm square} \phi {\curly j} d \xi d \eta
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
     \int  \int_{\Omega^e} \phi dx dy = \int  \int_{\rm square} \phi {\curly j} d \xi d \eta
\nonumber
\end{equation}</script>
</div>
<p>where <span><span class="MathJax_Preview">{\curly j}</span><script type="math/tex">{\curly j}</script></span> is the jacobian of the transformation defined by
\begin{equation}
         {\curly j} = {\rm det} \frac{\partial \mathbf{x}}{\partial \boldsymbol{\xi}} =
            {\rm det} \left[ \begin{array}{cc}<br />
                \frac{\partial x_1}{\partial \xi_1} &amp;  \frac{\partial x_1}{\partial \xi_2} \
                \frac{\partial x_2}{\partial \xi_1} &amp;  \frac{\partial x_2}{\partial \xi_2}
                \end{array}    \right]
\nonumber
\end{equation}</p>
<p>In the isoparametric concept, the components of the jacobian can be written as, for example,<br />
\begin{equation}
       \frac{\partial x_1}{\partial \xi_1} (\xi_1,\xi_2) = \sum_{a=1}^{n_en} \frac{\partial N_a}{\partial \xi_1} {x_1}_a
\nonumber
\end{equation}</p>
<p>Now we have the integral of a number of things defined over a regular, square domain (or cube etc).  A number of ways to estimate these integrals is available. For example, in 1D the familiar trapezium rule can integrate linearly interpolated functions exactly. Given that our approximate method has already reduced the degree of polynomial within the element to something manageable, it is possible to find integration schemes which produce the {\em exact} integral for our approximation --- in other words introducing no further error.</p>
<p>One possibility which is commonly used is Gaussian quadrature. This is a textbook method which can be made exact for any order of interpolation function desired. For linear interpolation in 2D, the following rule applies (assuming that we have transformed to a square element)</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \int\limits_{-1}^{1}  \int\limits_{-1}^{1} \phi(\xi,\eta) d\xi d\eta  \ \ \ \cong \ \ \
    \sum_{l=1}^{n_{\rm int}} \phi( \tilde{ \xi_l}, \tilde{ \eta_l}) W_l
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \int\limits_{-1}^{1}  \int\limits_{-1}^{1} \phi(\xi,\eta) d\xi d\eta  \ \ \ \cong \ \ \
    \sum_{l=1}^{n_{\rm int}} \phi( \tilde{ \xi_l}, \tilde{ \eta_l}) W_l
\nonumber
\end{equation}</script>
</div>
<p>In which <span><span class="MathJax_Preview">n_{\rm int}</span><script type="math/tex">n_{\rm int}</script></span> is the number of points in the quadrature rule with co-ordinates <span><span class="MathJax_Preview">(\tilde{ \xi_l}, \tilde{ \eta_l})</span><script type="math/tex">(\tilde{ \xi_l}, \tilde{ \eta_l})</script></span>. Each point has a weight associated with it of <span><span class="MathJax_Preview">W_l</span><script type="math/tex">W_l</script></span>. For the four point rule:</p>
<!-- not sure why the parser requires \{ in a table but not elsewhere ... but it does -->

<table>
<thead>
<tr>
<th>$ l $</th>
<th><span><span class="MathJax_Preview">\tilde{\xi _ l}</span><script type="math/tex">\tilde{\xi _ l}</script></span></th>
<th><span><span class="MathJax_Preview">\tilde{\eta _ l}</span><script type="math/tex">\tilde{\eta _ l}</script></span></th>
<th><span><span class="MathJax_Preview">W _ l</span><script type="math/tex">W _ l</script></span></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>$ -1/ \surd{3} $</td>
<td>\( -1/ \sqrt{3} \)</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>$ +1/ \surd{3} $</td>
<td>\( -1/ \sqrt{3} \)</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>$ -1/ \surd{3} $</td>
<td>\( +1/ \sqrt{3} \)</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>$ +1 /\surd{3} $</td>
<td>\( +1/ \sqrt{3} \)</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>The four-point rule in two dimensions is constructed by applying a two point, one dimensional rule to each of
the coordinates in turn. The integrals along the edges of the elements which are required to construct the
force vectors are therefore should be calculated using the one dimensional, two point rule which, along an edge of the bi-unit master element is</p>
<table>
<thead>
<tr>
<th><span><span class="MathJax_Preview">l</span><script type="math/tex">l</script></span></th>
<th><span><span class="MathJax_Preview">\tilde{\xi _ l}</span><script type="math/tex">\tilde{\xi _ l}</script></span></th>
<th><span><span class="MathJax_Preview">W _ l</span><script type="math/tex">W _ l</script></span></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><span><span class="MathJax_Preview">-1/\sqrt\{3\}</span><script type="math/tex">-1/\sqrt\{3\}</script></span></td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td><span><span class="MathJax_Preview">+1/\sqrt\{3\}</span><script type="math/tex">+1/\sqrt\{3\}</script></span></td>
<td>1</td>
</tr>
</tbody>
</table>
<p>This naturally extends to three dimensional elements and their two dimensional boundaries.</p>
<h3 id="standard-form-for-everything">Standard Form for Everything</h3>
<p>Consider the heat 1D conduction problem one more time. We can rewrite the generalized Fourier law as</p>
<div>
<div class="MathJax_Preview">\begin{equation}
        q_i = - \kappa_{ij} \frac{\partial u}{\partial x_j} =
         -\kappa_{ij} \left( \begin{array}{c} \frac{\partial}{\partial x_1} \\ \frac{\partial }{\partial x_2} \end{array} \right) u
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
        q_i = - \kappa_{ij} \frac{\partial u}{\partial x_j} =
         -\kappa_{ij} \left( \begin{array}{c} \frac{\partial}{\partial x_1} \\ \frac{\partial }{\partial x_2} \end{array} \right) u
\nonumber
\end{equation}</script>
</div>
<p>If we express <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> in terms of the shape functions</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    u = \sum_A d_A N_A (x)  \rightarrow
    q_i = -\kappa _ {ij} \sum_A \left( \begin{array}{c} {\displaystyle \frac{\partial N _ A}{\partial x _ 1}} \\
    { \displaystyle \frac{\partial N _ A}{\partial x _ 2}} \end{array} \right) d _ A
    q_i = - \sum_A \kappa _ {ij} \left. B _ A \right| _ {j} d _ A
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    u = \sum_A d_A N_A (x)  \rightarrow
    q_i = -\kappa _ {ij} \sum_A \left( \begin{array}{c} {\displaystyle \frac{\partial N _ A}{\partial x _ 1}} \\
    { \displaystyle \frac{\partial N _ A}{\partial x _ 2}} \end{array} \right) d _ A
    q_i = - \sum_A \kappa _ {ij} \left. B _ A \right| _ {j} d _ A
\nonumber
\end{equation}</script>
</div>
<p>This allows us to define a matrix <span><span class="MathJax_Preview">\mathbf{B _ A}</span><script type="math/tex">\mathbf{B _ A}</script></span> which comes directly from the operators contained in the constitutive law.</p>
<p>Compare this with equation ( \ref{eq:FEstdform}) and, the more concrete example (\ref{eq:festokes}) and we see that the stiffness matrix coefficients can be obtained from</p>
<div>
<div class="MathJax_Preview">\begin{equation}
        K_{AB} = a(N_A,N_B) = \int_{\Omega} \mathbf{B}_A^T \mathbf{D} \mathbf{B}_B d\Omega
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
        K_{AB} = a(N_A,N_B) = \int_{\Omega} \mathbf{B}_A^T \mathbf{D} \mathbf{B}_B d\Omega
\nonumber
\end{equation}</script>
</div>
<p>where <span><span class="MathJax_Preview">\mathbf{D}</span><script type="math/tex">\mathbf{D}</script></span> is a matrix of material properties.  This form can be used for all problems and may greatly simplify both programming and the automation of the development of the equations since now we simply need to be able to express the constitutive law in terms of the unknowns, build a material property matrix and plug this into standard machinery.</p>
<h2 id="constraints">Constraints</h2>
<p>We generally want to solve problems where there is a constraint on the unknowns. For example we wish to find a flow solution which also satisfies mass conservation (not unreasonable !). To see how this constraint may be applied we go back to the variational method and regard the equation <span><span class="MathJax_Preview">{\bf Kd = f}</span><script type="math/tex">{\bf Kd = f}</script></span> in the light of the functional</p>
<div>
<div class="MathJax_Preview">\begin{equation}
{\cal F} ({\bf d}) = \frac{ {\bf d}^T{\bf Kd}}{2} - {\bf d}^T {\bf f}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
{\cal F} ({\bf d}) = \frac{ {\bf d}^T{\bf Kd}}{2} - {\bf d}^T {\bf f}
\nonumber
\end{equation}</script>
</div>
<p>The vector which minimizes <span><span class="MathJax_Preview">{\cal F} ({\bf d})</span><script type="math/tex">{\cal F} ({\bf d})</script></span> is the solution to <span><span class="MathJax_Preview">{\bf Kd = f}</span><script type="math/tex">{\bf Kd = f}</script></span> - this can be shown in the usual way. (Start with $ {\cal F}({\bf d + \varepsilon c}) $, where <span><span class="MathJax_Preview">\varepsilon</span><script type="math/tex">\varepsilon</script></span> is a free, real parameter and <span><span class="MathJax_Preview">\bf c</span><script type="math/tex">\bf c</script></span> is arbitrary).</p>
<p>Consider a single constraint,</p>
<div>
<div class="MathJax_Preview">\begin{equation}
d_Q = {\curly g}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
d_Q = {\curly g}
\nonumber
\end{equation}</script>
</div>
<p>which corresponds to specifying a value for one of the velocities in the problem having the index <span><span class="MathJax_Preview">Q</span><script type="math/tex">Q</script></span> in the global numbering system. This constraint should be written as a function of <span><span class="MathJax_Preview">\bf d</span><script type="math/tex">\bf d</script></span>  in the following way:</p>
<div>
<div class="MathJax_Preview">\begin{equation}
0 = {\cal G}({\bf d}) = {\bf 1}_Q^T{\bf d} - {\curly g}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
0 = {\cal G}({\bf d}) = {\bf 1}_Q^T{\bf d} - {\curly g}
\nonumber
\end{equation}</script>
</div>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
    {\bf 1}^T_Q = \left\langle 0 \ldots 0  \right. &amp; 1 &amp; \left. 0 \ldots 0 \right\rangle \\ \nonumber
     &amp; \uparrow &amp; \! \\  \nonumber
     &amp; \text{  Q'th column} &amp; \nonumber
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
    {\bf 1}^T_Q = \left\langle 0 \ldots 0  \right. & 1 & \left. 0 \ldots 0 \right\rangle \\ \nonumber
     & \uparrow & \! \\  \nonumber
     & \text{  Q'th column} & \nonumber
\end{eqnarray}</script>
</div>
<p>Then finding the stationary value for the following function is equivalent to solving the constrained problem:</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    {\cal H}({\bf d},m) = {\cal F}({\bf d}) + m{\cal G}({\bf d})
    \nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    {\cal H}({\bf d},m) = {\cal F}({\bf d}) + m{\cal G}({\bf d})
    \nonumber
\end{equation}</script>
</div>
<p>The condition that <span><span class="MathJax_Preview">\bf d</span><script type="math/tex">\bf d</script></span> renders <span><span class="MathJax_Preview">\cal H</span><script type="math/tex">\cal H</script></span> stationary is</p>
<div>
<div class="MathJax_Preview">\begin{equation}
0 = \left. \frac{d}{d\varepsilon} {\cal H}({\bf d}+\varepsilon{\bf c},m + \varepsilon l) \right| _ {\varepsilon=0}
\;\;\; \forall {\bf c},l
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
0 = \left. \frac{d}{d\varepsilon} {\cal H}({\bf d}+\varepsilon{\bf c},m + \varepsilon l) \right| _ {\varepsilon=0}
\;\;\; \forall {\bf c},l
\nonumber
\end{equation}</script>
</div>
<p>Substituting for <span><span class="MathJax_Preview">\cal H</span><script type="math/tex">\cal H</script></span> gives:</p>
<div>
<div class="MathJax_Preview">\begin{equation}
0 = \left. \frac{d}{d\varepsilon} \left[ {\cal F}({\bf d}+\varepsilon{\bf c} )+
     (m+\varepsilon l){\cal G}({\bf d}+\varepsilon{\bf c} )\right] \right| _ {\varepsilon=0}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
0 = \left. \frac{d}{d\varepsilon} \left[ {\cal F}({\bf d}+\varepsilon{\bf c} )+
     (m+\varepsilon l){\cal G}({\bf d}+\varepsilon{\bf c} )\right] \right| _ {\varepsilon=0}
\nonumber
\end{equation}</script>
</div>
<div>
<div class="MathJax_Preview">\begin{equation}
0= {\bf c}^T({\bf Kd -F) }+l {\cal G}({\bf d}) + m{\bf 1}_Q^T {\bf c}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
0= {\bf c}^T({\bf Kd -F) }+l {\cal G}({\bf d}) + m{\bf 1}_Q^T {\bf c}
\nonumber
\end{equation}</script>
</div>
<div>
<div class="MathJax_Preview">\begin{equation}
0= {\bf c}^T({\bf Kd} + m{\bf 1} _ Q {\bf -f}) + l ({\bf 1}_Q^T {\bf d} -\mbox{\curly g})
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
0= {\bf c}^T({\bf Kd} + m{\bf 1} _ Q {\bf -f}) + l ({\bf 1}_Q^T {\bf d} -\mbox{\curly g})
\nonumber
\end{equation}</script>
</div>
<p>Since  <span><span class="MathJax_Preview">\bf c</span><script type="math/tex">\bf c</script></span> and <span><span class="MathJax_Preview">l</span><script type="math/tex">l</script></span> are strictly  arbitrary,</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
{\bf Kd }+m{\bf 1} _ Q &amp;=&amp; {\bf f}\\ \nonumber
{\bf 1} _ Q^T {\bf d} &amp; = &amp; {\curly g} \nonumber
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
{\bf Kd }+m{\bf 1} _ Q &=& {\bf f}\\ \nonumber
{\bf 1} _ Q^T {\bf d} & = & {\curly g} \nonumber
\end{eqnarray}</script>
</div>
<p>Equivalently</p>
<div>
<div class="MathJax_Preview">\begin{equation}
\left[
    \begin{array}{cc} {\bf K} &amp; {\bf 1} _ Q \\\\
                  {\bf 1} _ Q^T &amp; 0
    \end{array}
\right]
\left\\{
    \begin{array}{c} {\bf d} \\\\
                          m
    \end{array}
\right\\} =
\left\\{
    \begin{array}{c} {\bf f} \\\\
                     {\curly g}
    \end{array}
\right\\}
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
\left[
    \begin{array}{cc} {\bf K} & {\bf 1} _ Q \\\\
                  {\bf 1} _ Q^T & 0
    \end{array}
\right]
\left\\{
    \begin{array}{c} {\bf d} \\\\
                          m
    \end{array}
\right\\} =
\left\\{
    \begin{array}{c} {\bf f} \\\\
                     {\curly g}
    \end{array}
\right\\}
\end{equation}</script>
</div>
<p>which establishes the pattern  expected  for adding constraints to the physical problem: augmentation of all the matrices with some forces (<span><span class="MathJax_Preview">\bf m</span><script type="math/tex">\bf m</script></span>) as well as velocities (<span><span class="MathJax_Preview">\bf d</span><script type="math/tex">\bf d</script></span>)  unknown. The coefficient matrix remains symmetric but is no longer positive definite.</p>
<p>An alternative way to enforce constraints and one which proves slightly simpler to implement, is to make an approximation to the Lagrange-multiplier as follows:</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    m \cong k {\cal G}({\bf d})
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    m \cong k {\cal G}({\bf d})
\nonumber
\end{equation}</script>
</div>
<p>in which <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> is a large positive number. Form the following functional,</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    {\cal J}({\bf d}) = {\cal F}({\bf d}) + \frac{k}{2} \left[{\cal G} ({\bf d})\right]^2
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    {\cal J}({\bf d}) = {\cal F}({\bf d}) + \frac{k}{2} \left[{\cal G} ({\bf d})\right]^2
\nonumber
\end{equation}</script>
</div>
<p>and consider the extremal values for <span><span class="MathJax_Preview">\cal J</span><script type="math/tex">\cal J</script></span> which are defined by the following expression</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    0 = \left. \frac{d}{d\varepsilon} \left( {\cal F}({\bf d}+\varepsilon {\bf c} )+
    \frac{k}{2} \left[ {\cal G} ({\bf d} + \varepsilon{\bf c}) \right]^2 \right) \right| _ {\varepsilon = 0}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    0 = \left. \frac{d}{d\varepsilon} \left( {\cal F}({\bf d}+\varepsilon {\bf c} )+
    \frac{k}{2} \left[ {\cal G} ({\bf d} + \varepsilon{\bf c}) \right]^2 \right) \right| _ {\varepsilon = 0}
\nonumber
\end{equation}</script>
</div>
<div>
<div class="MathJax_Preview">\begin{equation}
    {\bf c}^T({\bf Kd - f}) + k {\bf G}({\bf d}) {\bf 1}_Q^T {\bf c}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    {\bf c}^T({\bf Kd - f}) + k {\bf G}({\bf d}) {\bf 1}_Q^T {\bf c}
\nonumber
\end{equation}</script>
</div>
<p>Substituting for <span><span class="MathJax_Preview">\cal G</span><script type="math/tex">\cal G</script></span> gives</p>
<div>
<div class="MathJax_Preview">\begin{equation}
{\bf c}^T \left[ ({\bf K} + k{\bf 1}_Q{\bf 1}_Q^T){\bf d} - ({\bf f} + k {\curly g} {\bf 1}_Q) \right] = 0
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
{\bf c}^T \left[ ({\bf K} + k{\bf 1}_Q{\bf 1}_Q^T){\bf d} - ({\bf f} + k {\curly g} {\bf 1}_Q) \right] = 0
\nonumber
\end{equation}</script>
</div>
<p>Since <span><span class="MathJax_Preview">\bf c</span><script type="math/tex">\bf c</script></span> is arbitrary, the following matrix equation is implied</p>
<div>
<div class="MathJax_Preview">\begin{equation}
({\bf K} + k{\bf 1}_Q{\bf 1}_Q^T){\bf d} = ({\bf f} + k {\curly g} {\bf 1}_Q)
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
({\bf K} + k{\bf 1}_Q{\bf 1}_Q^T){\bf d} = ({\bf f} + k {\curly g} {\bf 1}_Q)
\nonumber
\end{equation}</script>
</div>
<p>Now the dimension of the problem is not changed; the constraints are introduced by addition of another matrix equation. In the limit <span><span class="MathJax_Preview">k \rightarrow \infty</span><script type="math/tex">k \rightarrow \infty</script></span>, <span><span class="MathJax_Preview">d_Q \rightarrow {\curly g}</span><script type="math/tex">d_Q \rightarrow {\curly g}</script></span> and the constraint is applied exactly. The constraint of incompressibility is applied as the limiting case of slight compressibility. The large constant is known as the penalty parameter and gives its name to the method; its value is chosen according to the accuracy of the machine used to compute the solution to the problem. A suitable value is somewhere between <span><span class="MathJax_Preview">10^7</span><script type="math/tex">10^7</script></span> and <span><span class="MathJax_Preview">10^9</span><script type="math/tex">10^9</script></span>, any smaller and the fluid volume may not be conserved during hydrostatic loading.</p>
<p>The penalty method is computationally very simple, but can be ill conditioned. This becomes a serious issue when the matrix equation is not solved by direct methods. In the latter case, it is preferable to introduce additional variables. These take the form of pressures which, in the slightly compressible flow case can always be eliminated in favour of the constraint, and then recovered as</p>
<div>
<div class="MathJax_Preview">\begin{equation}
p = - \lambda \nabla . {\bf u}
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
p = - \lambda \nabla . {\bf u}
\nonumber
\end{equation}</script>
</div>
<p>The augmented matrix equation then becomes  </p>
<div>
<div class="MathJax_Preview">\begin{equation}
\left( \begin{array}{cc} \mathbf{K} &amp; \mathbf{G} \\\\ \mathbf{G}^T &amp;  0 \end{array} \right)
\left( \begin{array}{c} \mathbf{u} \\\\  \mathbf{p} \end{array} \right)=
\left( \begin{array}{c} \mathbf{f} \\\\  \mathbf{0} \end{array} \right)
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
\left( \begin{array}{cc} \mathbf{K} & \mathbf{G} \\\\ \mathbf{G}^T &  0 \end{array} \right)
\left( \begin{array}{c} \mathbf{u} \\\\  \mathbf{p} \end{array} \right)=
\left( \begin{array}{c} \mathbf{f} \\\\  \mathbf{0} \end{array} \right)
\nonumber
\end{equation}</script>
</div>
<p>The components of the <span><span class="MathJax_Preview">\mathbf{G}</span><script type="math/tex">\mathbf{G}</script></span> matrix are, at the element level found from</p>
<div>
<div class="MathJax_Preview">\begin{equation}
\left.  g^e_{a\tilde{a}}  \right| _ {i} = -\int_{\Omega^e} {\rm div}(N_a) (\tilde{N}) _ {\tilde{a}} d\Omega
\nonumber
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
\left.  g^e_{a\tilde{a}}  \right| _ {i} = -\int_{\Omega^e} {\rm div}(N_a) (\tilde{N}) _ {\tilde{a}} d\Omega
\nonumber
\end{equation}</script>
</div>
<p>The tilde indicates a pressure degree of freedom / shape function as constrasted with the standard velocity shape fucntions. The independent pressures require their own space of trial functions which can be of lower order than the velocity since the derivatives in the equations are also lower. In fact, it is necessary to use lower order functions for the pressure otherwise the problem is overconstrained and no non-trivial solution can be found. This is more of a difficulty when the penalty formulation is used since there are no additional variables and hence no associated trial functions. Instead a trick is used - the constraint terms are integrated using an order lower integration scheme than that required for exact solutions. The result turns out to be equivalent (usually) to the introduction of additional variables and lower order shape functions but the proof of this is another tricky matter.</p>
<!-- ### Incremental Formulations

In plasticity, for example, only incremental changes in the system are
meaningful since the stress is degenerate to multiple strains and depends
on the loading history. In this situation one deals with an incremental
formulation of the entire problem replacing the stiffness matrix with
a tangent stiffness from a Newton-Raphson type procedure. This is not
an issue with simple fluids but should be understood when brittle solids
are considered. -->

<h3 id="stresses">Stresses</h3>
<p><strong>Note</strong> Derivatives of the shape functions are commonly not defined at the node points and consequently it is not possible to compute stresses etc at the nodal points. They are defined on the interiors of the elements and must be extrapolated to the nodes using some form of best fit procedure.</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../js/mathjax-local-config.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../../search/main.js" defer></script>
    <script type="text/javascript" defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
